name: C/C++ CI

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    services:
      irods:
        image: docker://wsinpg/ub-12.04-irods-4.1:latest
        ports:
          - 1247:1247

    container:
      image: docker://wsinpg/ub-12.04-conda:latest
      volumes:
        - ./conda_home:/home/conda

    steps:      
      - uses: actions/checkout@v1
      - name: debug
        env:
         CONDA_USER_ID: 9001
         CONDA_USER: conda
         CONDA_GROUP_ID: 32001
         CONDA_INSTALL_DIR: /opt/conda
         CONDA_HOME: /home/conda
         CONDA_BLD_PATH=: /home/conda/artefacts
        run: |
          useradd --shell /bin/bash --uid $CONDA_USER_ID --gid $CONDA_GROUP_ID --non-unique --create-home $CONDA_USER --comment ""
          export USER=$CONDA_USER
          export HOME=$CONDA_HOME
          export LOGNAME=$CONDA_USER
          export MAIL=/var/spool/mail/$CONDA_USER
          export PATH="$CONDA_INSTALL_DIR/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
          
          cp "$CONDA_INSTALL_DIR/etc/condarc" "$HOME/.condarc"
          
          chown -R $USER:$USER /home/$USER
          chmod g+w "$CONDA_INSTALL_DIR"

          gosu $USER /bin/bash
          ls -l $HOME
          cd
          touch foo
          
      - name: foo
        run: |
          ls -l /home/conda
  
        

